<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background-color: white;
        color: black;
    }

    body.dark-mode {
        background-color: #1a1a1a;
        color: white;
    }

    #d3-svg-container {
        width: 100vw;
        height: 100vh;
    }

    .axis text {
        font-size: 16px;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .regression-text {
        font-size: 20px;
        fill: black;
    }

    /* Classe personalizada para estilizar os eixos */
    .axis-label {
        font-size: 18px;
    }
</style>

<body> <!-- class="dark-mode" -->
    <svg id="d3-svg-container"></svg>
    <script>
        const d3A = d3;

        $.getScript("https://unpkg.com/d3-regression@1.3.10/dist/d3-regression.min.js")
            .done(function (script, textStatus) {
                d3 = Object.assign(d3A, d3)

                let data = JSON.parse('[18.162536952390447,19.423535548002285,19.578326285051137,19.341139826988123,19.355138149343652,19.248593009106663,19.27029647974348,21.606393072682966,22.160793407412445,24.20636616751621,25.705792536910526,25.517024107990878,25.72607625909111,26.098273731327513,26.278327287901526,26.38399917814466,26.721094224612106,27.680798674150495,27.594714755111077,27.73239211811826,27.761418183080533,27.514379386013132,27.364419380084236,27.32842435510223,27.483806691494344,27.458225517181447,27.384182535359955,27.411597944897142,27.51948437034151,27.62720933110653,27.96104966310412,28.15513355129344,28.120791955337854,28.249279881797467,28.146469973757814,28.192875333626,28.29653835630368]');
                data = data.map((value, index) => [1985 + index, value]);

                const margin = { top: 50, right: 50, bottom: 50, left: 100 };
                const width = window.innerWidth - margin.left - margin.right;
                const height = window.innerHeight - margin.top - margin.bottom;

                const svg = d3.select("#d3-svg-container")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                const x = d3.scaleLinear()
                    .range([0, width])
                    .domain([1985, 2021]);

                const xScale = d3.axisBottom(x)
                    .tickFormat(d3.format("d"))
                    .tickPadding(10);

                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xScale)
                    .selectAll(".tick text")
                    .attr("class", "axis-label");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -margin.left)
                    .attr("x", -height / 2)
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .style("font-size", "24px")
                    .text("%");

                const minValue = Math.min(...data.map(a => a[1]));
                const maxValue = Math.max(...data.map(a => a[1]));

                const y = d3.scaleLinear()
                    .range([height, 0])
                    .domain([minValue, maxValue]);

                const yScale = d3.axisLeft(y)
                    .tickPadding(10);

                svg.append("g")
                    .call(yScale)
                    .selectAll(".tick text")
                    .attr("class", "axis-label")

                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", -30)
                    .attr("text-anchor", "middle")
                    .text(`Linear regression`)
                    .attr("class", "regression-text");

                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", -10)
                    .attr("text-anchor", "middle")
                    .text(`EOO`)
                    .attr("class", "regression-text");

                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", 10)
                    .attr("text-anchor", "middle")
                    .text(`Anthropic`)
                    .attr("class", "regression-text");

                // Segundo texto com species em itálico
                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", 30)
                    .attr("text-anchor", "middle")
                    .attr("class", "regression-text")
                    .append("tspan") // Adiciona species em itálico
                    .attr("font-style", "italic")
                    .text(`Mimosa suburbana`);

                svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", d => x(d[0]))
                    .attr("cy", d => y(d[1]))
                    .attr("r", 4)
                    .attr("fill", "steelblue")

                linearRegression = d3.regressionLinear()
                    .x(d => d["0"])
                    .y(d => d["1"])

                linearRegressionData = linearRegression(data)

                svg.append("path")
                    .datum(linearRegressionData)
                    .attr("d", d3.line()
                        .x(d => x(d[0]))
                        .y(d => y(d[1]))
                    )
                    .attr("stroke", "red")
                    .attr("stroke-width", 2)
                    .attr("fill", "none")

                svg.append("text")
                    .attr("x", 10)
                    .attr("y", 20)
                    .text(`y = ${linearRegressionData.a.toFixed(2)}x + ${linearRegressionData.b.toFixed(2)}`)
                    .attr("class", "regression-text")

                svg.append("text")
                    .attr("x", 10)
                    .attr("y", 50)
                    .text(`R² = ${linearRegressionData.rSquared.toFixed(5)}`)
                    .attr("class", "regression-text")

            })
            .fail(function (jqxhr, settings, exception) {
                console.error(exception)
            });

    </script>
</body>

</html>