<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background-color: white;
        color: black;
    }

    body.dark-mode {
        background-color: #1a1a1a;
        color: white;
    }

    #d3-svg-container {
        width: 100vw;
        height: 100vh;
    }

    .axis text {
        font-size: 16px;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .regression-text {
        font-size: 20px;
        fill: black;
    }

    /* Classe personalizada para estilizar os eixos */
    .axis-label {
        font-size: 18px;
    }
</style>

<body> <!-- class="dark-mode" -->
    <svg id="d3-svg-container"></svg>
    <script>
        const d3A = d3;

        $.getScript("https://unpkg.com/d3-regression@1.3.10/dist/d3-regression.min.js")
            .done(function (script, textStatus) {
                d3 = Object.assign(d3A, d3)

                let data = JSON.parse('[0.02717282429604185,0.026874698440643968,0.02727282517204705,0.027311029714959446,0.02824940867182004,0.028562949506275012,0.02870048444865938,0.028700269515086568,0.02806117968024664,0.02785049583638185,0.02836193136387926,0.027365004693641504,0.026831290445277697,0.02683576754740096,0.02653822751444615,0.025756428750118247,0.025828490128522563,0.026297683906349706,0.026156725932114683,0.026487889014079374,0.026531431484739576,0.02666822543239453,0.027360929979067684,0.027435530362993593,0.027782256425238516,0.02687417487397034,0.026853782006174512,0.027028834984218805,0.0270091036979642,0.02684099485135881,0.026551999755215914,0.02649318020359098,0.026414713534490746,0.026706107421077287,0.026033350995439696,0.025944499891435723,0.025812457804089483]');
                data = data.map((value, index) => [1985 + index, value]);

                const margin = { top: 50, right: 50, bottom: 50, left: 100 };
                const width = window.innerWidth - margin.left - margin.right;
                const height = window.innerHeight - margin.top - margin.bottom;

                const svg = d3.select("#d3-svg-container")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                const x = d3.scaleLinear()
                    .range([0, width])
                    .domain([1985, 2021]);

                const xScale = d3.axisBottom(x)
                    .tickFormat(d3.format("d"))
                    .tickPadding(10);

                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xScale)
                    .selectAll(".tick text")
                    .attr("class", "axis-label");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -margin.left)
                    .attr("x", -height / 2)
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .style("font-size", "24px")
                    .text("%");

                const minValue = Math.min(...data.map(a => a[1]));
                const maxValue = Math.max(...data.map(a => a[1]));

                const y = d3.scaleLinear()
                    .range([height, 0])
                    .domain([minValue, maxValue]);

                const yScale = d3.axisLeft(y)
                    .tickPadding(10);

                svg.append("g")
                    .call(yScale)
                    .selectAll(".tick text")
                    .attr("class", "axis-label")

                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", -30)
                    .attr("text-anchor", "middle")
                    .text(`Linear regression`)
                    .attr("class", "regression-text");

                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", -10)
                    .attr("text-anchor", "middle")
                    .text(`EOO`)
                    .attr("class", "regression-text");

                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", 10)
                    .attr("text-anchor", "middle")
                    .text(`Other non forest formations`)
                    .attr("class", "regression-text");

                // Segundo texto com species em itálico
                svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", 30)
                    .attr("text-anchor", "middle")
                    .attr("class", "regression-text")
                    .append("tspan") // Adiciona species em itálico
                    .attr("font-style", "italic")
                    .text(`Apuleia leiocarpa`);

                svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", d => x(d[0]))
                    .attr("cy", d => y(d[1]))
                    .attr("r", 4)
                    .attr("fill", "steelblue")

                linearRegression = d3.regressionLinear()
                    .x(d => d["0"])
                    .y(d => d["1"])

                linearRegressionData = linearRegression(data)

                svg.append("path")
                    .datum(linearRegressionData)
                    .attr("d", d3.line()
                        .x(d => x(d[0]))
                        .y(d => y(d[1]))
                    )
                    .attr("stroke", "red")
                    .attr("stroke-width", 2)
                    .attr("fill", "none")

                svg.append("text")
                    .attr("x", 10)
                    .attr("y", 20)
                    .text(`y = ${linearRegressionData.a.toFixed(2)}x + ${linearRegressionData.b.toFixed(2)}`)
                    .attr("class", "regression-text")

                svg.append("text")
                    .attr("x", 10)
                    .attr("y", 50)
                    .text(`R² = ${linearRegressionData.rSquared.toFixed(5)}`)
                    .attr("class", "regression-text")

            })
            .fail(function (jqxhr, settings, exception) {
                console.error(exception)
            });

    </script>
</body>

</html>